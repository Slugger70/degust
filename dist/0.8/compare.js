(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){require("./lib/bootstrap-tour.js");require("./slider.coffee");require("./gene_table.coffee");require("./parcoords.coffee");require("./ma_plot.coffee");require("./heatmap.coffee");require("./kegg.coffee");require("./tour.coffee");require("./compare.coffee")},{"./compare.coffee":2,"./gene_table.coffee":3,"./heatmap.coffee":4,"./kegg.coffee":5,"./lib/bootstrap-tour.js":6,"./ma_plot.coffee":7,"./parcoords.coffee":8,"./slider.coffee":9,"./tour.coffee":10}],2:[function(require,module,exports){var WithBackendAnalysis,WithBackendNoAnalysis,WithoutBackend,activate_ma_plot,activate_parcoords,blue_to_brown,calc_kegg_colours,colour_by_ec,colour_by_pval,colour_cat20,comparer,config_url,do_sort,done_loading,expr_filter,expr_plot,fcThreshold,fc_div,fdrThreshold,g_backend,g_data,g_tour_setup,gene_table,gene_table_dblclick,gene_table_filter,gene_table_mouseout,gene_table_mouseover,h_runfilters,heatmap,html_escape,init,init_charts,init_download_link,init_page,init_search,init_slider,kegg,kegg_filter,kegg_mouseover,kegg_selected,ma_plot,num_loading,parcoords,process_dge_data,process_kegg_data,redraw_plot,render_page,requested_kegg,searchStr,set_gene_table,show_counts,show_r_code,start_loading,update_data,update_flags,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};config_url=function(){return"config.html?code="+window.my_code};num_loading=0;start_loading=function(){num_loading+=1;$("#loading").show();return $("#dge-pc,#dge-ma").css("opacity",.4)};done_loading=function(){num_loading-=1;if(num_loading===0){$("#loading").hide();return $("#dge-pc,#dge-ma").css("opacity",1)}};html_escape=function(str){return $("<div/>").text(str).html()};WithoutBackend=function(){function WithoutBackend(settings,process_dge_data){this.settings=settings;this.process_dge_data=process_dge_data;$(".conditions").hide();$(".config").hide();$("a.show-r-code").hide()}WithoutBackend.prototype.request_init_data=function(){var _this=this;start_loading();if(this.settings.csv_data){log_info("Using embedded csv");return this._data_ready(this.settings.csv_data)}else{return d3.text(this.settings.csv_file,"text/csv",function(err,dat){log_info("Downloaded csv");log_debug("Downloaded csv",dat,err);if(err){log_error(err);return}return _this._data_ready(dat)})}};WithoutBackend.prototype._data_ready=function(dat){var data;if(this.settings.csv_format){data=d3.csv.parse(dat)}else{data=d3.tsv.parse(dat)}this.process_dge_data(data,this.settings.columns);return done_loading()};WithoutBackend.prototype.request_kegg_data=function(callback){return log_error("Get KEGG data not supported without backend")};return WithoutBackend}();WithBackendNoAnalysis=function(){function WithBackendNoAnalysis(settings,process_dge_data){this.settings=settings;this.process_dge_data=process_dge_data;if(this.settings.fc_columns.length===0){window.location=config_url()}$(".conditions").hide();$("a.show-r-code").hide();if(this.settings["locked"]){$("a.config").hide()}else{$("a.config").removeClass("hide");$("a.config").attr("href",config_url())}}WithBackendNoAnalysis.prototype._script=function(params){return"r-json.cgi?code="+window.my_code+"&"+params};WithBackendNoAnalysis.prototype.request_kegg_data=function(callback){return d3.tsv(this._script("query=kegg_titles"),function(err,ec_data){log_info("Downloaded kegg : rows="+ec_data.length);log_debug("Downloaded kegg : rows="+ec_data.length,ec_data,err);return callback(ec_data)})};WithBackendNoAnalysis.prototype.request_init_data=function(){var _this=this;start_loading();return d3.text(this._script("query=csv"),function(err,dat){var data,data_cols;if(err){log_error(err);return}if(settings.csv_format){data=d3.csv.parse(dat)}else{data=d3.tsv.parse(dat)}log_info("Downloaded DGE : rows="+data.length);log_debug("Downloaded DGE : rows="+data.length,data,err);done_loading();data_cols=settings.info_columns.map(function(n){return{idx:n,name:n,type:"info"}});data_cols.push({idx:"_dummy",type:"primary",name:settings.primary_name});settings.fc_columns.forEach(function(n){return data_cols.push({idx:n,type:"fc",name:n})});data_cols.push({idx:settings.fdr_column,name:settings.fdr_column,type:"fdr"});data_cols.push({idx:settings.avg_column,name:settings.avg_column,type:"avg"});if(settings.ec_column!=null){data_cols.push({idx:settings.ec_column,name:"EC",type:"ec"})}return _this.process_dge_data(data,data_cols)})};return WithBackendNoAnalysis}();WithBackendAnalysis=function(){function WithBackendAnalysis(settings,process_dge_data){this.settings=settings;this.process_dge_data=process_dge_data;if(this.settings.replicates.length===0){window.location=config_url()}$(".conditions").show();$("a.show-r-code").show();if(this.settings["locked"]){$("a.config").hide()}else{$("a.config").removeClass("hide");$("a.config").attr("href",config_url())}}WithBackendAnalysis.prototype._script=function(params){return"r-json.cgi?code="+window.my_code+"&"+params};WithBackendAnalysis.prototype.request_init_data=function(){return this._init_condition_selector()};WithBackendAnalysis.prototype.request_kegg_data=function(callback){return d3.tsv(this._script("query=kegg_titles"),function(err,ec_data){log_info("Downloaded kegg : rows="+ec_data.length);log_debug("Downloaded kegg : rows="+ec_data.length,ec_data,err);return callback(ec_data)})};WithBackendAnalysis.prototype.request_dge_data=function(columns){var req,_this=this;if(columns.length<=1){return}req=this._script("query=dge&fields="+JSON.stringify(columns));start_loading();return d3.csv(req,function(err,data){var data_cols,pri;log_info("Downloaded DGE : rows="+data.length);log_debug("Downloaded DGE : rows="+data.length,data,err);done_loading();data_cols=settings.info_columns.map(function(n){return{idx:n,name:n,type:"info"}});pri=true;columns.forEach(function(n){var typ;typ=pri?"primary":"fc";data_cols.push({idx:n,type:typ,name:n});return pri=false});data_cols.push({idx:"adj.P.Val",name:"FDR",type:"fdr"});data_cols.push({idx:"AveExpr",name:"AveExpr",type:"avg"});if(settings.ec_column!=null){data_cols.push({idx:settings.ec_column,name:"EC",type:"ec"})}settings.replicates.forEach(function(_arg){var name,reps;name=_arg[0],reps=_arg[1];return reps.forEach(function(rep){return data_cols.push({idx:rep,name:rep,type:"count",parent:name})})});return _this.process_dge_data(data,data_cols)})};WithBackendAnalysis.prototype.request_r_code=function(callback){var columns,req;columns=this._get_selected_cols();req=this._script("query=dge_r_code&fields="+JSON.stringify(columns));return d3.text(req,function(err,data){log_debug("Downloaded R Code : len="+data.length,data,err);return callback(data)})};WithBackendAnalysis.prototype._select_sample=function(e){var el;el=$(e.target).parent("div");$(el).toggleClass("selected");return this._update_samples()};WithBackendAnalysis.prototype._get_selected_cols=function(){var cols,_this=this;cols=[];$("#files div.selected").each(function(i,n){var rep_name;rep_name=$(n).data("rep");return cols.push(rep_name)});return cols};WithBackendAnalysis.prototype._update_samples=function(){return this.request_dge_data(this._get_selected_cols())};WithBackendAnalysis.prototype._init_condition_selector=function(){var init_select,_this=this;init_select=this.settings["init_select"]||[];$.each(this.settings.replicates,function(i,rep){var div,name;name=rep[0];div=$("<div class='rep_"+i+"'>"+("  <a class='file' href='#' title='Select this condition' data-placement='right'>"+name+"</a>")+"</div>");$("#files").append(div);div.data("rep",name);if(__indexOf.call(init_select,name)>=0){return div.addClass("selected")}});$("#files a.file").click(function(e){return _this._select_sample(e)});return this._update_samples()};return WithBackendAnalysis}();blue_to_brown=d3.scale.linear().domain([0,.05,1]).range(["brown","steelblue","steelblue"]).interpolate(d3.interpolateLab);colour_cat20=d3.scale.category20().domain([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]);colour_by_ec=function(ec_col){return function(row){return colour_cat20(row[ec_col])}};colour_by_pval=function(col){return function(d){return blue_to_brown(d[col])}};parcoords=null;ma_plot=null;expr_plot=null;gene_table=null;kegg=null;heatmap=null;g_data=null;g_backend=null;requested_kegg=false;show_counts=false;fdrThreshold=1;fcThreshold=0;searchStr="";kegg_filter=[];h_runfilters=null;g_tour_setup=false;kegg_mouseover=function(obj){var ec,ec_col,row,rows,_i,_len,_ref;ec=obj.id;rows=[];ec_col=g_data.column_by_type("ec");if(ec_col===null){return}_ref=g_data.get_data();for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];if(row[ec_col]===ec){rows.push(row)}}return expr_plot.highlight(rows)};gene_table_mouseover=function(item){var ec_col;expr_plot.highlight([item]);ec_col=g_data.column_by_type("ec");return kegg.highlight(item[ec_col])};gene_table_mouseout=function(){expr_plot.unhighlight();$("#gene-info").html("");return kegg.unhighlight()};gene_table_dblclick=function(item){var cols,str;cols=g_data.columns_by_type(["info"]);if(cols.length>0){str=item[cols[0].idx];window.open("http://ensembl.org/Multi/Search/Results?q="+str+";site=ensembl");return window.focus()}};activate_parcoords=function(){expr_plot=parcoords;$("#dge-ma").hide();$("#dge-pc").show();$("#select-pc").addClass("active");$("#select-ma").removeClass("active");$(".ma-fc-col-opt").hide();return update_data()};activate_ma_plot=function(){expr_plot=ma_plot;$("#dge-pc").hide();$("#dge-ma").show();$("#select-ma").addClass("active");$("#select-pc").removeClass("active");$(".ma-fc-col-opt").show();return update_data()};init_charts=function(){parcoords=new ParCoords({elem:"#dge-pc",filter:expr_filter});ma_plot=new MAPlot({elem:"#dge-ma",filter:expr_filter});gene_table=new GeneTable({elem:"#grid",elem_info:"#grid-info",sorter:do_sort,mouseover:gene_table_mouseover,mouseout:gene_table_mouseout,dblclick:gene_table_dblclick,filter:gene_table_filter});kegg=new Kegg({elem:"div#kegg-image",mouseover:kegg_mouseover,mouseout:function(){return expr_plot.unhighlight()}});parcoords.on("brush",function(d){gene_table.set_data(d);return heatmap.schedule_update(d)});ma_plot.on("brush",function(d){gene_table.set_data(d);return heatmap.schedule_update(d)});return heatmap=new Heatmap({elem:"#heatmap",width:$(".container").width(),mouseover:function(d){var col,msg,_i,_len,_ref;expr_plot.highlight([d]);msg="";_ref=g_data.columns_by_type(["info"]);for(_i=0,_len=_ref.length;_i<_len;_i++){col=_ref[_i];msg+="<span class='lbl'>"+col.name+": </span><span>"+d[col.idx]+"</span>"}return $("#heatmap-info").html(msg)},mouseout:function(d){expr_plot.unhighlight();return $("#heatmap-info").html("")}})};comparer=function(x,y){if(x===y){return 0}else{if(x>y){return 1}else{return-1}}};do_sort=function(args){var column;column=g_data.column_by_idx(args.sortCol.field);return gene_table.sort(function(r1,r2){var r,x,y,_ref,_ref1;r=0;x=r1[column.idx];y=r2[column.idx];if((_ref=column.type)==="fc_calc"){r=comparer(Math.abs(x),Math.abs(y))}else if((_ref1=column.type)==="fdr"){r=comparer(x,y)}else{r=comparer(x,y)}return r*(args.sortAsc?1:-1)})};set_gene_table=function(data){var column_keys,columns;column_keys=g_data.columns_by_type(["info","fdr"]);column_keys=column_keys.concat(g_data.columns_by_type("fc_calc"));columns=column_keys.map(function(col){return{id:col.idx,name:col.name,field:col.idx,sortable:true,formatter:function(i,c,val,m,row){var _ref,_ref1;if((_ref=col.type)==="fc_calc"){return fc_div(val,col,row)}else if((_ref1=col.type)==="fdr"){if(val<.01){return val.toExponential(2)}else{return val.toFixed(2)}}else{return val}}}});return gene_table.set_data(data,columns)};fc_div=function(n,column,row){var colour,countStr,count_columns,counts;colour=n>.1?"pos":n<-.1?"neg":"";countStr="";if(show_counts){count_columns=g_data.assoc_column_by_type("count",column.name);counts=count_columns.map(function(c){return row[c.idx]});countStr="<span class='counts'>("+counts+")</span>"}return"<div class='"+colour+"'>"+n.toFixed(2)+countStr+"</div>"};gene_table_filter=function(item){var col,str,_i,_len,_ref;if(searchStr===""){return true}_ref=g_data.columns_by_type("info");for(_i=0,_len=_ref.length;_i<_len;_i++){col=_ref[_i];str=item[col.idx];if(str&&str.toLowerCase().indexOf(searchStr)>=0){return true}}return false};expr_filter=function(row){var col,col_type,ec_col,keep,pval_col,_i,_len,_ref,_ref1;if(fcThreshold>0){keep=false;col_type="fc_calc";_ref=g_data.columns_by_type(col_type);for(_i=0,_len=_ref.length;_i<_len;_i++){col=_ref[_i];if(Math.abs(row[col.idx])>fcThreshold){keep=true;break}}if(!keep){return false}}pval_col=g_data.columns_by_type("fdr")[0];if(row[pval_col.idx]>fdrThreshold){return false}if(kegg_filter.length>0){ec_col=g_data.column_by_type("ec");return _ref1=row[ec_col],__indexOf.call(kegg_filter,_ref1)>=0}return true};init_search=function(){return $(".tab-search input").keyup(function(e){Slick.GlobalEditorLock.cancelCurrentEdit();if(e.which===27){this.value=""}searchStr=this.value.toLowerCase();return gene_table.refresh()})};init_download_link=function(){return $("a#csv-download").on("click",function(e){var cols,items,keys,rows;e.preventDefault();items=gene_table.get_data();if(items.length===0){return}cols=g_data.columns_by_type(["info","fc_calc","count","fdr"]);keys=cols.map(function(c){return c.name});rows=items.map(function(r){return cols.map(function(c){return r[c.idx]})});return window.open("data:text/csv,"+escape(d3.csv.format([keys].concat(rows))),"file.csv")})};redraw_plot=function(){return expr_plot.brush()};init_slider=function(){var x;new Slider({id:"#fdrSlider",input_id:"input.fdr-fld",step_values:[0,1e-6,1e-5,1e-4,.001,.01,.02,.03,.04,.05,.1,1],val:fdrThreshold,validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0||n>1)},on_change:function(v){Slick.GlobalEditorLock.cancelCurrentEdit();if(fdrThreshold!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return fdrThreshold=v}}});new Slider({id:"#fcSlider",input_id:"input.fc-fld",step_values:function(){var _i,_results;_results=[];for(x=_i=0;_i<=5;x=_i+=.01){_results.push(Number(x.toFixed(2)))}return _results}(),val:fcThreshold,validator:function(v){var n;n=Number(v);return!(isNaN(n)||n<0)},on_change:function(v){Slick.GlobalEditorLock.cancelCurrentEdit();if(fcThreshold!==v){window.clearTimeout(h_runfilters);h_runfilters=window.setTimeout(redraw_plot,10);return fcThreshold=v}}});$("#fc-relative").change(function(e){return update_data()});$("#ma-fc-col").change(function(e){return update_data()});return $("#show-counts-cb").on("click",function(e){update_flags();return gene_table.invalidate()})};calc_kegg_colours=function(){var col,dir,ec,ec_col,ec_dirs,fc_cols,row,v,_i,_j,_len,_len1,_ref;ec_dirs={};ec_col=g_data.column_by_type("ec");if(ec_col===null){return}fc_cols=g_data.columns_by_type("fc_calc").slice(1);_ref=g_data.get_data();for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];ec=row[ec_col];if(!ec){continue}for(_j=0,_len1=fc_cols.length;_j<_len1;_j++){col=fc_cols[_j];v=row[col.idx];dir=v>.1?"up":v<-.1?"down":"same";if(!ec_dirs[ec]){ec_dirs[ec]=dir}if(ec_dirs[ec]!==dir){ec_dirs[ec]="mixed"}}}return ec_dirs};kegg_selected=function(){var code,ec_colours,set_filter,title;code=$("select#kegg option:selected").val();title=$("select#kegg option:selected").text();set_filter=function(ec){kegg_filter=ec;return update_data()};if(!code){return set_filter([])}else{ec_colours=calc_kegg_colours();kegg.load(code,ec_colours,set_filter);return $("div#kegg-image").dialog({width:500,height:600,title:title,position:{my:"right top",at:"right top+60",of:$("body")}})}};process_kegg_data=function(ec_data){var ec_col,have_ec,opts,row,_i,_len,_ref;if(requested_kegg){return}requested_kegg=true;opts="<option value=''>--- No pathway selected ---</option>";have_ec={};ec_col=g_data.column_by_type("ec");_ref=g_data.get_data();for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];have_ec[row[ec_col]]=1}ec_data.forEach(function(row){var ec,num,_j,_len1,_ref1;num=0;_ref1=row.ec.split(" ").filter(function(s){return s.length>0});for(_j=0,_len1=_ref1.length;_j<_len1;_j++){ec=_ref1[_j];if(have_ec[ec]){num++}}if(num>0){return opts+="<option value='"+row.code+"'>"+row.title+" ("+num+")</option>"}});$("select#kegg").html(opts);return $(".kegg-filter").show()};process_dge_data=function(data,columns){var col,i,opts,_i,_j,_len,_len1,_ref,_ref1;g_data=new GeneData(data,columns);opts="";_ref=g_data.columns_by_type(["fc","primary"]);for(i=_i=0,_len=_ref.length;_i<_len;i=++_i){col=_ref[i];opts+="<option value='"+i+"'>"+html_escape(col.name)+"</option>"}opts+="<option value='-1'>Average</option>";$("select#fc-relative").html(opts);opts="";_ref1=g_data.columns_by_type(["fc","primary"]);for(i=_j=0,_len1=_ref1.length;_j<_len1;i=++_j){col=_ref1[i];opts+="<option value='"+i+"' "+(i===1?"selected":"")+">"+html_escape(col.name)+"</option>"}$("select#ma-fc-col").html(opts);if(g_data.column_by_type("ec")===null){$(".kegg-filter").hide()}else if(!requested_kegg){g_backend.request_kegg_data(process_kegg_data)}if(g_data.columns_by_type("count").length===0){$(".show-counts-opt").hide()}else{$(".show-counts-opt").show()}if(g_data.columns_by_type(["fc","primary"]).length>2){activate_parcoords()}else{activate_ma_plot()}if(!g_tour_setup){g_tour_setup=true;return setup_tour(true)}};update_flags=function(){return show_counts=$("#show-counts-cb").is(":checked")};update_data=function(){var col,color,dims,ec_col,extent,fc_relative,ma_fc,pval_col;update_flags();fc_relative=$("select#fc-relative option:selected").val();if(fc_relative<0){fc_relative="avg"}else{fc_relative=g_data.columns_by_type(["fc","primary"])[fc_relative]}g_data.set_relative(fc_relative);dims=g_data.columns_by_type("fc_calc");ec_col=g_data.column_by_type("ec");pval_col=g_data.column_by_type("fdr");color=colour_by_pval(pval_col);extent=ParCoords.calc_extent(g_data.get_data(),dims);if(expr_plot===parcoords){parcoords.update_data(g_data.get_data(),dims,extent,color)}else if(expr_plot===ma_plot){ma_fc=$("select#ma-fc-col option:selected").val();ma_fc=g_data.columns_by_type(["fc","primary"])[ma_fc].name;col=g_data.columns_by_type("fc_calc").filter(function(c){return c.name===ma_fc});if(col.length!==1){log_error("Can't find proper column for MA-plot")}ma_plot.update_data(g_data.get_data(),col,g_data.columns_by_type("avg"),color,g_data.columns_by_type("info"),pval_col)}set_gene_table(g_data.get_data());heatmap.schedule_update(g_data.get_data());heatmap.update_columns(dims,extent,pval_col);return expr_plot.brush()};show_r_code=function(){return g_backend.request_r_code(function(d){$("div#code-modal .modal-body pre").text(d);return $("div#code-modal").modal()})};render_page=function(){var body,opts;opts={asset_base:settings.asset_base||"",home_link:settings.home_link||"index.html"};body=$(require("../templates/compare-body.hbs")(opts));$("#replace-me").replaceWith(body);$("#main-loading").hide();setup_nav_bar();return $("[title]").tooltip()};init_page=function(use_backend){render_page();g_data=new GeneData([],[]);if(use_backend){if(settings.analyze_server_side){g_backend=new WithBackendAnalysis(settings,process_dge_data)}else{g_backend=new WithBackendNoAnalysis(settings,process_dge_data)}}else{g_backend=new WithoutBackend(settings,process_dge_data)}$(".exp-name").text(settings.name||"Unnamed");if(settings["fdrThreshold"]!==void 0){fdrThreshold=settings["fdrThreshold"]}if(settings["fcThreshold"]!==void 0){fcThreshold=settings["fcThreshold"]}$("select#kegg").change(kegg_selected);$("#select-pc a").click(function(){return activate_parcoords()});$("#select-ma a").click(function(){return activate_ma_plot()});$("a.show-r-code").click(function(){return show_r_code()});init_charts();init_search();init_slider();init_download_link();return g_backend.request_init_data()};init=function(){var code,script;code=get_url_vars()["code"];if(code==null){return init_page(false)}else{script=function(params){return"r-json.cgi?code="+window.my_code+(params?"&"+params:"")};window.my_code=code;return $.ajax({type:"GET",url:script("query=settings"),dataType:"json"}).done(function(json){window.settings=json;return init_page(true)}).fail(function(x){return log_error("Failed to get settings!")})}};$(document).ready(function(){return init()})},{"../templates/compare-body.hbs":11}],3:[function(require,module,exports){var GeneTable;GeneTable=function(){function GeneTable(opts){var grid_options,_this=this;this.opts=opts;grid_options={enableCellNavigation:true,enableColumnReorder:false,multiColumnSort:false,forceFitColumns:true};this.dataView=new Slick.Data.DataView;this.grid=new Slick.Grid(this.opts.elem,this.dataView,[],grid_options);if(this.opts.filter){this.dataView.setFilter(this.opts.filter)}this.dataView.onRowCountChanged.subscribe(function(e,args){_this.grid.updateRowCount();_this.grid.render();return _this._update_info()});this.dataView.onRowsChanged.subscribe(function(e,args){_this.grid.invalidateRows(args.rows);return _this.grid.render()});this.grid.onSort.subscribe(function(e,args){return _this.opts.sorter(args)});this.grid.onViewportChanged.subscribe(function(e,args){return _this._update_info()});if(this.opts.mouseover){this.grid.onMouseEnter.subscribe(function(e,args){var d,i;i=_this.grid.getCellFromEvent(e).row;d=_this.dataView.getItem(i);return _this.opts.mouseover(d)})}if(this.opts.mouseout){this.grid.onMouseLeave.subscribe(function(e,args){return _this.opts.mouseout()})}if(this.opts.dblclick){this.grid.onDblClick.subscribe(function(e,args){return _this.opts.dblclick(_this.grid.getDataItem(args.row))})}}GeneTable.prototype.sort=function(sorter){return this.dataView.sort(sorter)};GeneTable.prototype.get_data=function(){return this.dataView.getItems()};GeneTable.prototype.set_data=function(data,columns){var _this=this;if(columns){return scheduler.schedule_now("gene_table",function(){return _this.set_data_now(data,columns)})}else{return scheduler.schedule("gene_table",function(){return _this.set_data_now(data)})}};GeneTable.prototype.set_data_now=function(data,columns){this.dataView.beginUpdate();if(columns){this.grid.setColumns([])}this.dataView.setItems(data);this.dataView.reSort();this.dataView.endUpdate();if(columns){return this.grid.setColumns(columns)}};GeneTable.prototype.refresh=function(){return this.dataView.refresh()};GeneTable.prototype.invalidate=function(){return this.grid.invalidate()};GeneTable.prototype._update_info=function(){var btm,view;view=this.grid.getViewport();btm=d3.min([view.bottom,this.dataView.getLength()]);return $(this.opts.elem_info).html("Showing "+view.top+".."+btm+" of "+this.dataView.getLength())};return GeneTable}();window.GeneTable=GeneTable},{}],4:[function(require,module,exports){var Heatmap;Heatmap=function(){function Heatmap(opts){var _base,_base1,_base2,_base3,_base4;this.opts=opts;if((_base=this.opts).h_pad==null){_base.h_pad=20}if((_base1=this.opts).h==null){_base1.h=50}if((_base2=this.opts).width==null){_base2.width=1e3}if((_base3=this.opts).label_width==null){_base3.label_width=120}if((_base4=this.opts).limit==null){_base4.limit=this.opts.width-this.opts.label_width}this.svg=d3.select(this.opts.elem).append("svg");this.svg.append("g").attr("class","labels");this.svg.append("g").attr("class","genes").attr("transform","translate("+opts.label_width+",0)");this.svg.attr("width",this.opts.width).attr("height",100);this.info=this.svg.append("text").attr("class","info").attr("x",this.opts.width-200).attr("y",10)}Heatmap.prototype.set_order=function(order){this.order=order};Heatmap.prototype._show_calc_info=function(str){return this.info.text(str)};Heatmap.prototype._calc_order=function(){var calc_routine,order,t1,used,_this=this;if(this.data.length===0){this.order=[];return}t1=new Date;used={0:true};order=[0];calc_routine=function(){var best_d,best_i,d,i,r,row,yield_after,_i,_ref;yield_after=50;while(order.length<_this.data.length&&yield_after-->0){row=_this.data[order[order.length-1]];best_i=best_d=null;for(i=_i=0,_ref=_this.data.length-1;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i){if(used[i]){continue}r=_this.data[i];d=_this._dist(row,r);if(!best_d||d<best_d){best_d=d;best_i=i}}order.push(best_i);used[best_i]=true}if(order.length>=_this.data.length){_this.order=order.map(function(i){return _this.data[i].id});log_debug("calc_order: took="+(new Date-t1)+"ms for "+_this.data.length+" points",order,_this.order);_this._render_heatmap();return _this._show_calc_info("")}else{scheduler.schedule("heatmap.calc",calc_routine,50);return _this._show_calc_info("Clustered "+order.length+" of "+_this.data.length)}};if(this.data.length>3e3){return scheduler.schedule("heatmap.calc",calc_routine,10*1e3)}else{return scheduler.schedule("heatmap.calc",calc_routine,10)}};Heatmap.prototype._dist=function(r1,r2){var c,s,v,_i,_len,_ref;s=0;_ref=this.columns;for(_i=0,_len=_ref.length;_i<_len;_i++){c=_ref[_i];v=r1[c.idx]-r2[c.idx];s+=v*v}return s};Heatmap.prototype.schedule_update=function(data){if(data){this.data=data}this.svg.attr("opacity",.4);return this._calc_order()};Heatmap.prototype.update_columns=function(columns,extent,sel_column){var cols,_this=this;this.columns=columns;this.sel_column=sel_column;this.max=d3.max(extent.map(Math.abs));this.colorScale=d3.scale.linear().domain([-this.max,0,this.max]).range(["red","white","blue"]);cols=this.svg.select("#heatmap .labels").selectAll(".label").data(this.columns);cols.enter().append("text").attr("class","label");cols.exit().remove();return cols.attr("x",this.opts.label_width).attr("y",function(d,i){return i*_this.opts.h+_this.opts.h/2}).attr("text-anchor","end").text(function(d){return d.name})};Heatmap.prototype._render_heatmap=function(){var cells,d,genes,id,kept_data,num_kept,row_ids,sorted,w,_i,_j,_len,_len1,_ref,_ref1,_this=this;this.svg.attr("opacity",1);kept_data={};sorted=this.data.slice(0);sorted.sort(function(a,b){return a[_this.sel_column]-b[_this.sel_column]});_ref=sorted.slice(0,+(this.opts.limit-1)+1||9e9);for(_i=0,_len=_ref.length;_i<_len;_i++){d=_ref[_i];kept_data[d.id]=d}row_ids={};num_kept=0;_ref1=this.order||data.map(function(d){return d.id});for(_j=0,_len1=_ref1.length;_j<_len1;_j++){id=_ref1[_j];if(kept_data[id]){row_ids[id]=num_kept;num_kept+=1}}this.svg.attr("width",this.opts.width).attr("height",this.opts.h_pad+this.opts.h*this.columns.length);w=d3.min([this.opts.h,(this.opts.width-this.opts.label_width)/num_kept]);genes=this.svg.select("#heatmap .genes").selectAll("g.gene").data(d3.values(kept_data));genes.enter().append("g").attr("class","gene");genes.exit().remove();cells=genes.selectAll(".cell").data(function(d){var c,i,res,_ref2;if(row_ids[d.id]==null){log_info("missing row_ids["+d.id+"]");return}res=[];_ref2=_this.columns;for(i in _ref2){c=_ref2[i];res.push({row:row_ids[d.id],col:i,score:d[c.idx],id:d.id})}return res},function(d){return d.col});cells.enter().append("rect").attr("class","cell");cells.attr("x",function(d){return d.row*w}).attr("y",function(d){return d.col*_this.opts.h}).attr("width",w).attr("height",this.opts.h).style("fill",function(d){return _this.colorScale(d.score)});cells.exit().remove();if(this.opts.mouseover){genes.on("mouseover",this.opts.mouseover)}if(this.opts.mouseout){return genes.on("mouseout",this.opts.mouseout)}};Heatmap.prototype._create_brush=function(w){var brush,gBrush,x,_this=this;x=d3.scale.identity().domain([0,this.opts.width-this.opts.label_width]);brush=d3.svg.brush().x(x).on("brushend",function(){var d,data,ex;ex=brush.extent();data=_this.svg.selectAll("rect.cell").data();return d=data.filter(function(d){return d.col==="0"&&ex[0]<=d.row*w&&ex[1]>=d.row*w})});this.svg.select("g.brush").remove();gBrush=this.svg.append("g").attr("class","brush").attr("transform","translate("+this.opts.label_width+",0)").call(brush);return gBrush.selectAll("rect").attr("height",100*this.opts.h_pad+this.opts.h*this.columns.length)};return Heatmap}();window.Heatmap=Heatmap},{}],5:[function(require,module,exports){var Kegg;Kegg=function(){function Kegg(opts){this.opts=opts;this.ec_visible={}}Kegg.prototype.load=function(code,ec_colours,ec_cb){var _this=this;this.ec_colours=ec_colours;this.img_x=void 0;this.kegg_data=void 0;this.img_url="kegg/pathway/map/map"+code+".gif";$(this.opts.elem).html("<div id='kegg-container'></div>");$("<img/>").attr("src",this.img_url).load(function(e){_this.img_x=e.target.width;_this.img_y=e.target.height;return _this.draw_ec()});return d3.xml("kegg/kgml/map/map"+code+".xml",function(data){return _this.xml_loaded(data,ec_cb)})};Kegg.prototype.xml_loaded=function(xml,ec_cb){var ec_codes;this.kegg_data=this.xml_to_list(xml);if(ec_cb){ec_codes=[];ec_codes=this.kegg_data.map(function(o){return o.id});if(ec_cb){ec_cb(ec_codes)}}return this.draw_ec()};Kegg.prototype.draw_ec=function(){var ec_boxes,_this=this;if(!this.kegg_data||!this.img_x){return}d3.select("div#kegg-container").html("");this.svg=d3.select("div#kegg-container").append("svg").attr("viewBox","1 1 "+this.img_x+" "+this.img_y).attr("width","100%").attr("height","100%");this.svg.append("image").attr("xlink:href",this.img_url).attr("width",this.img_x).attr("height",this.img_y);ec_boxes=this.svg.selectAll(".ec").data(this.kegg_data,function(o){return o.id});ec_boxes.enter().append("rect").attr("class","ec").attr("x",function(o){return o.x-o.width/2}).attr("y",function(o){return o.y-o.height/2}).attr("width",function(o){return o.width}).attr("height",function(o){return o.height}).attr("stroke","black").attr("fill-opacity",.3).attr("fill",function(o){return _this.colour(o.id)});ec_boxes.exit().remove();if(this.opts.mouseover){ec_boxes.on("mouseover",this.opts.mouseover)}if(this.opts.mouseout){return ec_boxes.on("mouseout",this.opts.mouseout)}};Kegg.prototype.rect=function(o){return g.append("rect")};Kegg.prototype.xml_to_list=function(xml){var list,_this=this;list=[];$("entry[type=enzyme] graphics[type=rectangle]",xml).each(function(i,e_){var e,k,o,_i,_len,_ref;e=$(e_);o={id:e.attr("name")};if(o.id in _this.ec_colours){_ref=["x","y","width","height"];for(_i=0,_len=_ref.length;_i<_len;_i++){k=_ref[_i];o[k]=e.attr(k)}return list.push(o)}});return list};Kegg.prototype.colour=function(ec){switch(this.ec_colours[ec]){case"same":return"blue";case"mixed":return"yellow";case"up":return"green";case"down":return"blue";default:return"black"}};Kegg.prototype.highlight=function(ec){if(this.svg){return this.svg.selectAll(".ec").filter(function(o){return o.id===ec}).attr("stroke-width",5).attr("stroke","red")}};Kegg.prototype.unhighlight=function(){if(this.svg){return this.svg.selectAll(".ec").attr("stroke-width",1).attr("stroke","black")}};return Kegg}();window.Kegg=Kegg},{}],6:[function(require,module,exports){(function(){(function($,window){var Tour,document;document=window.document;Tour=function(){function Tour(options){this._options=$.extend({name:"tour",container:"body",keyboard:true,storage:window.localStorage,debug:false,backdrop:false,redirect:true,orphan:false,basePath:"",template:"<div class='popover'>          <div class='arrow'></div>          <h3 class='popover-title'></h3>          <div class='popover-content'></div>          <nav class='popover-navigation'>            <div class='btn-group'>              <button class='btn btn-sm btn-default' data-role='prev'>&laquo; Prev</button>              <button class='btn btn-sm btn-default' data-role='next'>Next &raquo;</button>            </div>            <button class='btn btn-sm btn-default' data-role='end'>End tour</button>          </nav>        </div>",afterSetState:function(key,value){},afterGetState:function(key,value){},afterRemoveState:function(key){},onStart:function(tour){},onEnd:function(tour){},onShow:function(tour){},onShown:function(tour){},onHide:function(tour){},onHidden:function(tour){},onNext:function(tour){},onPrev:function(tour){}},options);
this._steps=[];this.setCurrentStep();this.backdrop={overlay:null,$element:null,$background:null}}Tour.prototype.setState=function(key,value){var keyName;if(this._options.storage){keyName=""+this._options.name+"_"+key;this._options.storage.setItem(keyName,value);return this._options.afterSetState(keyName,value)}else{if(this._state==null){this._state={}}return this._state[key]=value}};Tour.prototype.removeState=function(key){var keyName;if(this._options.storage){keyName=""+this._options.name+"_"+key;this._options.storage.removeItem(keyName);return this._options.afterRemoveState(keyName)}else{if(this._state!=null){return delete this._state[key]}}};Tour.prototype.getState=function(key){var keyName,value;if(this._options.storage){keyName=""+this._options.name+"_"+key;value=this._options.storage.getItem(keyName)}else{if(this._state!=null){value=this._state[key]}}if(value===void 0||value==="null"){value=null}this._options.afterGetState(key,value);return value};Tour.prototype.addSteps=function(steps){var step,_i,_len,_results;_results=[];for(_i=0,_len=steps.length;_i<_len;_i++){step=steps[_i];_results.push(this.addStep(step))}return _results};Tour.prototype.addStep=function(step){return this._steps.push(step)};Tour.prototype.getStep=function(i){if(this._steps[i]!=null){return $.extend({id:"step-"+i,path:"",placement:"right",title:"",content:"<p></p>",next:i===this._steps.length-1?-1:i+1,prev:i-1,animation:true,container:this._options.container,backdrop:this._options.backdrop,redirect:this._options.redirect,orphan:this._options.orphan,template:this._options.template,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev},this._steps[i])}};Tour.prototype.start=function(force){var promise,_this=this;if(force==null){force=false}if(this.ended()&&!force){return this._debug("Tour ended, start prevented.")}$(document).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=next]").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=next]:not(.disabled)",function(e){e.preventDefault();return _this.next()});$(document).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=prev]").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=prev]:not(.disabled)",function(e){e.preventDefault();return _this.prev()});$(document).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=end]").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=end]",function(e){e.preventDefault();return _this.end()});this._onResize(function(){return _this.showStep(_this._current)});this._setupKeyboardNavigation();promise=this._makePromise(this._options.onStart!=null?this._options.onStart(this):void 0);return this._callOnPromiseDone(promise,this.showStep,this._current)};Tour.prototype.next=function(){var promise;if(this.ended()){return this._debug("Tour ended, next prevented.")}promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,this._showNextStep)};Tour.prototype.prev=function(){var promise;if(this.ended()){return this._debug("Tour ended, prev prevented.")}promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,this._showPrevStep)};Tour.prototype.goto=function(i){var promise;if(this.ended()){return this._debug("Tour ended, goto prevented.")}promise=this.hideStep(this._current);return this._callOnPromiseDone(promise,this.showStep,i)};Tour.prototype.end=function(){var endHelper,hidePromise,_this=this;endHelper=function(e){$(document).off("click.tour-"+_this._options.name);$(document).off("keyup.tour-"+_this._options.name);$(window).off("resize.tour-"+_this._options.name);_this.setState("end","yes");if(_this._options.onEnd!=null){return _this._options.onEnd(_this)}};hidePromise=this.hideStep(this._current);return this._callOnPromiseDone(hidePromise,endHelper)};Tour.prototype.ended=function(){return!!this.getState("end")};Tour.prototype.restart=function(){this.removeState("current_step");this.removeState("end");this.setCurrentStep(0);return this.start()};Tour.prototype.hideStep=function(i){var hideStepHelper,promise,step,_this=this;step=this.getStep(i);promise=this._makePromise(step.onHide!=null?step.onHide(this,i):void 0);hideStepHelper=function(e){var $element;$element=_this._isOrphan(step)?$("body"):$(step.element);$element.popover("destroy");if(step.reflex){$element.css("cursor","").off("click.tour-"+_this._options.name)}if(step.backdrop){_this._hideBackdrop()}if(step.onHidden!=null){return step.onHidden(_this)}};this._callOnPromiseDone(promise,hideStepHelper);return promise};Tour.prototype.showStep=function(i){var promise,showStepHelper,skipToPrevious,step,_this=this;step=this.getStep(i);if(!step){return}skipToPrevious=i<this._current;promise=this._makePromise(step.onShow!=null?step.onShow(this,i):void 0);showStepHelper=function(e){var current_path,path;_this.setCurrentStep(i);path=$.isFunction(step.path)?step.path.call():_this._options.basePath+step.path;current_path=[document.location.pathname,document.location.hash].join("");if(_this._isRedirect(path,current_path)){_this._redirect(step,path);return}if(_this._isOrphan(step)){if(!step.orphan){_this._debug("Skip the orphan step "+(_this._current+1)+". Orphan option is false and the element doesn't exist or is hidden.");if(skipToPrevious){_this._showPrevStep()}else{_this._showNextStep()}return}_this._debug("Show the orphan step "+(_this._current+1)+". Orphans option is true.")}if(step.backdrop){_this._showBackdrop(!_this._isOrphan(step)?step.element:void 0)}_this._showPopover(step,i);if(step.onShown!=null){step.onShown(_this)}return _this._debug("Step "+(_this._current+1)+" of "+_this._steps.length)};return this._callOnPromiseDone(promise,showStepHelper)};Tour.prototype.setCurrentStep=function(value){if(value!=null){this._current=value;return this.setState("current_step",value)}else{this._current=this.getState("current_step");return this._current=this._current===null?0:parseInt(this._current,10)}};Tour.prototype._showNextStep=function(){var promise,showNextStepHelper,step,_this=this;step=this.getStep(this._current);showNextStepHelper=function(e){return _this.showStep(step.next)};promise=this._makePromise(step.onNext!=null?step.onNext(this):void 0);return this._callOnPromiseDone(promise,showNextStepHelper)};Tour.prototype._showPrevStep=function(){var promise,showPrevStepHelper,step,_this=this;step=this.getStep(this._current);showPrevStepHelper=function(e){return _this.showStep(step.prev)};promise=this._makePromise(step.onPrev!=null?step.onPrev(this):void 0);return this._callOnPromiseDone(promise,showPrevStepHelper)};Tour.prototype._debug=function(text){if(this._options.debug){return window.console.log("Bootstrap Tour '"+this._options.name+"' | "+text)}};Tour.prototype._isRedirect=function(path,currentPath){return path!=null&&path!==""&&path.replace(/\?.*$/,"").replace(/\/?$/,"")!==currentPath.replace(/\/?$/,"")};Tour.prototype._redirect=function(step,path){if($.isFunction(step.redirect)){return step.redirect.call(this,path)}else if(step.redirect===true){this._debug("Redirect to "+path);return document.location.href=path}};Tour.prototype._isOrphan=function(step){return step.element==null||!$(step.element).length||$(step.element).is(":hidden")};Tour.prototype._showPopover=function(step,i){var $element,$navigation,$template,$tip,isOrphan,options,_this=this;options=$.extend({},this._options);$template=$.isFunction(step.template)?$(step.template(i,step)):$(step.template);$navigation=$template.find(".popover-navigation");isOrphan=this._isOrphan(step);if(isOrphan){step.element="body";step.placement="top";$template=$template.addClass("orphan")}$element=$(step.element);$template.addClass("tour-"+this._options.name);if(step.options){$.extend(options,step.options)}if(step.reflex){$element.css("cursor","pointer").on("click.tour-"+this._options.name,function(e){if(_this._current<_this._steps.length-1){return _this.next()}else{return _this.end()}})}if(step.prev<0){$navigation.find("*[data-role=prev]").addClass("disabled")}if(step.next<0){$navigation.find("*[data-role=next]").addClass("disabled")}step.template=$template.clone().wrap("<div>").parent().html();$element.popover({placement:step.placement,trigger:"manual",title:step.title,content:step.content,html:true,animation:step.animation,container:step.container,template:step.template,selector:step.element}).popover("show");$tip=$element.data("bs.popover")?$element.data("bs.popover").tip():$element.data("popover").tip();$tip.attr("id",step.id);this._scrollIntoView($tip);this._reposition($tip,step);if(isOrphan){return this._center($tip)}};Tour.prototype._reposition=function($tip,step){var offsetBottom,offsetHeight,offsetRight,offsetWidth,originalLeft,originalTop,tipOffset;offsetWidth=$tip[0].offsetWidth;offsetHeight=$tip[0].offsetHeight;tipOffset=$tip.offset();originalLeft=tipOffset.left;originalTop=tipOffset.top;offsetBottom=$(document).outerHeight()-tipOffset.top-$tip.outerHeight();if(offsetBottom<0){tipOffset.top=tipOffset.top+offsetBottom}offsetRight=$("html").outerWidth()-tipOffset.left-$tip.outerWidth();if(offsetRight<0){tipOffset.left=tipOffset.left+offsetRight}if(tipOffset.top<0){tipOffset.top=0}if(tipOffset.left<0){tipOffset.left=0}$tip.offset(tipOffset);if(step.placement==="bottom"||step.placement==="top"){if(originalLeft!==tipOffset.left){return this._replaceArrow($tip,(tipOffset.left-originalLeft)*2,offsetWidth,"left")}}else{if(originalTop!==tipOffset.top){return this._replaceArrow($tip,(tipOffset.top-originalTop)*2,offsetHeight,"top")}}};Tour.prototype._center=function($tip){return $tip.css("top",$(window).outerHeight()/2-$tip.outerHeight()/2)};Tour.prototype._replaceArrow=function($tip,delta,dimension,position){return $tip.find(".arrow").css(position,delta?50*(1-delta/dimension)+"%":"")};Tour.prototype._scrollIntoView=function(tip){return $("html, body").stop().animate({scrollTop:Math.ceil(tip.offset().top-$(window).height()/2)})};Tour.prototype._onResize=function(callback,timeout){return $(window).on("resize.tour-"+this._options.name,function(){clearTimeout(timeout);return timeout=setTimeout(callback,100)})};Tour.prototype._setupKeyboardNavigation=function(){var _this=this;if(this._options.keyboard){return $(document).on("keyup.tour-"+this._options.name,function(e){if(!e.which){return}switch(e.which){case 39:e.preventDefault();if(_this._current<_this._steps.length-1){return _this.next()}else{return _this.end()}break;case 37:e.preventDefault();if(_this._current>0){return _this.prev()}break;case 27:e.preventDefault();return _this.end()}})}};Tour.prototype._makePromise=function(result){if(result&&$.isFunction(result.then)){return result}else{return null}};Tour.prototype._callOnPromiseDone=function(promise,cb,arg){var _this=this;if(promise){return promise.then(function(e){return cb.call(_this,arg)})}else{return cb.call(this,arg)}};Tour.prototype._showBackdrop=function(element){if(this.backdrop.overlay!==null){return}this._showOverlay();if(element!=null){return this._showOverlayElement(element)}};Tour.prototype._hideBackdrop=function(){if(this.backdrop.overlay===null){return}if(this.backdrop.$element){this._hideOverlayElement()}return this._hideOverlay()};Tour.prototype._showOverlay=function(){this.backdrop=$("<div/>",{"class":"tour-backdrop"});return $("body").append(this.backdrop)};Tour.prototype._hideOverlay=function(){this.backdrop.remove();return this.backdrop.overlay=null};Tour.prototype._showOverlayElement=function(element){var $background,$element,offset;$element=$(element);$background=$("<div/>");offset=$element.offset();offset.top=offset.top;offset.left=offset.left;$background.width($element.innerWidth()).height($element.innerHeight()).addClass("tour-step-background").offset(offset);$element.addClass("tour-step-backdrop");$("body").append($background);this.backdrop.$element=$element;return this.backdrop.$background=$background};Tour.prototype._hideOverlayElement=function(){this.backdrop.$element.removeClass("tour-step-backdrop");this.backdrop.$background.remove();this.backdrop.$element=null;return this.backdrop.$background=null};return Tour}();return window.Tour=Tour})(jQuery,window)}).call(this)},{}],7:[function(require,module,exports){var MAPlot;MAPlot=function(){function MAPlot(opts){var _base,_base1,_base2,_this=this;this.opts=opts;if((_base=this.opts).height==null){_base.height=300}if((_base1=this.opts).width==null){_base1.width=600}if((_base2=this.opts).padding==null){_base2.padding=20}this.gDot=d3.select(this.opts.elem).append("canvas");this.gDot.attr("width",this.opts.width).attr("height",this.opts.height);this.svg=d3.select(this.opts.elem).append("svg");this.svg.attr("width",this.opts.width).attr("height",this.opts.height);this.gBrush=this.svg.append("g");this.gBrush.on("mousemove",function(){return _this._mouse_move()});this.gBrush.on("mouseout",function(){return _this._mouse_out()});this.gHighlight=this.svg.append("g");this.tooltip=d3.select(this.opts.elem).append("div").attr("class","tooltip").style("opacity",0);this.dispatch=d3.dispatch("brush")}MAPlot.prototype.update_data=function(data,fc_dim,ave_dim,coloring,info_cols,fdr_col){var a_dim,m_dim,xAxis,xScale,yAxis,yScale,_this=this;this.data=data;this.coloring=coloring;this.info_cols=info_cols;this.fdr_col=fdr_col;if(fc_dim.length!==1||ave_dim.length!==1){log_info("Only support 2 dimensions for ma-plot",fc_dim,ave_dim);return}this.svg.select("g.brush").remove();this.svg.selectAll(".axis").remove();this.m_dim=m_dim=function(d){return d[fc_dim[0].idx]};this.a_dim=a_dim=function(d){return d[ave_dim[0].idx]};this.xScale=xScale=d3.scale.linear().domain(d3.extent(data,function(d){return a_dim(d)}).map(function(x){return x*1.05})).range([this.opts.padding,this.opts.width-this.opts.padding]);this.yScale=yScale=d3.scale.linear().domain(d3.extent(data,function(d){return m_dim(d)}).map(function(x){return x*1.05})).range([this.opts.height-this.opts.padding,this.opts.padding]);xAxis=d3.svg.axis().scale(xScale).orient("bottom");yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(5);this.mybrush=d3.svg.brush().x(xScale).y(yScale).clamp([false,false]).on("brush",function(){return _this._brushed()});this.gBrush.call(this.mybrush);this._draw_dots();this.svg.append("g").attr("class","axis").attr("transform","translate(0,"+yScale(0)+")").call(xAxis);return this.svg.append("g").attr("class","axis").attr("transform","translate("+this.opts.padding+",0)").call(yAxis)};MAPlot.prototype._draw_dots=function(){var ctx,i,_results,_this=this;ctx=this.gDot[0][0].getContext("2d");ctx.clearRect(0,0,this.opts.width,this.opts.height);i=this.data.length;_results=[];while(i--){_results.push(function(i){var d;d=_this.data[i];if(_this.opts.filter(d)){ctx.fillStyle=_this.coloring(d);ctx.globalAlpha=.7;ctx.beginPath();ctx.arc(_this.xScale(_this.a_dim(d)),_this.yScale(_this.m_dim(d)),3,0,Math.PI*2);return ctx.fill()}}(i))}return _results};MAPlot.prototype._mouse_move=function(){var loc,_this=this;loc=d3.mouse(this.gDot[0][0]);this._hide_info();return scheduler.schedule("maplot.tooltip",function(){return _this._handle_tooltip(loc)},20)};MAPlot.prototype._mouse_out=function(){var _this=this;this._hide_info();return scheduler.schedule("maplot.tooltip",function(){})};MAPlot.prototype._handle_tooltip=function(loc){var ex,m,sz,x,y;x=loc[0],y=loc[1];sz=3;ex=[[this.xScale.invert(x-sz),this.yScale.invert(y+sz)],[this.xScale.invert(x+sz),this.yScale.invert(y-sz)]];m=this._in_extent(ex);if(m.length>0){return this._show_info(loc,m)}else{return this._hide_info()}};MAPlot.prototype._show_info=function(loc,rows){var fmt,fmt2,info,row;fmt=function(val){return val.toFixed(2)};fmt2=function(val){if(val<.01){return val.toExponential(2)}else{return val.toFixed(2)}};this.tooltip.transition().duration(200).style("opacity",.8);info="<table>";row=rows[0];this.info_cols.forEach(function(c){return info+="<tr><td><b>"+c.name+"</b>:<td>"+row[c.idx]});info+="<tr><td><b>A</b>:<td>"+fmt(this.a_dim(row));info+="<tr><td><b>M</b>:<td>"+fmt(this.m_dim(row));info+="<tr><td><b>FDR</b>:<td>"+fmt2(row[this.fdr_col]);info+="</table>";if(rows.length>1){info+="(And "+(rows.length-1)+" other"+(rows.length>2?"s":"")+")"}return this.tooltip.html(info).style("left",loc[0]+10+"px").style("top",loc[1]+15+"px")};MAPlot.prototype._hide_info=function(){return this.tooltip.style("opacity",0)};MAPlot.prototype._brushed=function(){var sel;sel=this._selected();return this.dispatch.brush(sel)};MAPlot.prototype._in_extent=function(ex){var _this=this;return this.data.filter(function(d){var x,y;y=_this.m_dim(d);x=_this.a_dim(d);return _this.opts.filter(d)&&x>=ex[0][0]&&x<=ex[1][0]&&y>=ex[0][1]&&y<=ex[1][1]})};MAPlot.prototype._selected=function(){var _this=this;if(this.mybrush.empty()){return this.data.filter(function(d){return _this.opts.filter(d)})}else{return this._in_extent(this.mybrush.extent())}};MAPlot.prototype.highlight=function(rows){var hi,_this=this;hi=this.gHighlight.selectAll(".highlight").data(rows,function(d){return d.id});hi.exit().remove();hi.enter().insert("circle").attr("class","highlight").attr("opacity",1).style("fill-opacity",0).style("stroke","black").style("stroke-width",3);return hi.attr("r",15).attr("cx",function(d){return _this.xScale(_this.a_dim(d))}).attr("cy",function(d){return _this.yScale(_this.m_dim(d))}).transition().duration(500).attr("r",7)};MAPlot.prototype.unhighlight=function(){return this.svg.selectAll(".highlight").remove()};MAPlot.prototype.on=function(t,func){return this.dispatch.on(t,func)};MAPlot.prototype.brush=function(){this._draw_dots();return this._brushed()};return MAPlot}();window.MAPlot=MAPlot},{}],8:[function(require,module,exports){var ParCoords;ParCoords=function(){function ParCoords(opts){var _base,_base1,_base2,_base3;this.opts=opts;if((_base=this.opts).h==null){_base.h=50}if((_base1=this.opts).width==null){_base1.width=1e3}if((_base2=this.opts).label_width==null){_base2.label_width=120}if((_base3=this.opts).limit==null){_base3.limit=this.opts.width-this.opts.label_width}this.parcoords=d3.parcoords()(this.opts.elem).alpha(.4).reorderable().brushable().mode("queue");this.parcoords.setFilter(this.opts.filter)}ParCoords.prototype.update_data=function(data,dims,extent,coloring){var dim_names,h,_this=this;dim_names={};dims.forEach(function(k){return dim_names[k.idx]=k.name});this.parcoords.data(data).dimensions(dims.map(function(c){return c.idx})).dimension_names(dim_names).autoscale();if(coloring){this.parcoords.color(coloring)}if(extent==null){extent=ParCoords.calc_extent(data,dims)}h=this.parcoords.height()-this.parcoords.margin().top-this.parcoords.margin().bottom;this.parcoords.dimensions().forEach(function(k){return _this.parcoords.yscale[k]=d3.scale.linear().domain(extent).range([h+1,1])});this.parcoords.createAxes().render().reorderable().brushable();this.parcoords.render();return this.parcoords.brush()};ParCoords.calc_extent=function(data,dims){var extent,extents;extents=[];dims.forEach(function(k){return extents.push(d3.extent(data,function(v){return+v[k.idx]}))});extent=d3.extent(d3.merge(extents));return extent.map(function(v){return v*1.05})};ParCoords.prototype.highlight=function(d){return this.parcoords.highlight(d)};ParCoords.prototype.unhighlight=function(){return this.parcoords.unhighlight()};ParCoords.prototype.on=function(t,func){return this.parcoords.on(t,func)};ParCoords.prototype.brush=function(){return this.parcoords.brush()};return ParCoords}();window.ParCoords=ParCoords},{}],9:[function(require,module,exports){var Slider;Slider=function(){Slider.prototype.set_slider=function(v){var set_i;set_i=0;$.each(this.stepValues,function(i,v2){if(v2<=v){return set_i=i}});return this.slider.slider("value",set_i)};Slider.prototype.fmt=function(v){var n;n=Number(v);if(n===void 0){return v}else if(n>0&&n<.001){return n.toExponential(0)}else{return v}};function Slider(opts){var self,_this=this;this.opts=opts;this.stepValues=opts.step_values||[0,1,2,3,4,5,6,7,8,9,10];this.slider=$(opts.id).slider({animate:true,min:0,max:this.stepValues.length-1,value:1,slide:function(event,ui){var v;v=_this.stepValues[ui.value];$(opts.input_id).val(_this.fmt(v));return opts.on_change(v)}});if(opts.val!==void 0){$(opts.input_id).val(opts.val);this.set_slider(opts.val)}self=this;$(opts.input_id).keyup(function(){var v;v=$(this).val();if(opts.validator(v)){$(this).removeClass("error");self.set_slider(v);return opts.on_change(v)}else{return $(this).addClass("error")}})}return Slider}();window.Slider=Slider},{}],10:[function(require,module,exports){var tour_steps;jQuery.fn.d3Click=function(){return this.each(function(i,e){var evt;evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);return e.dispatchEvent(evt)})};tour_steps=[{title:"<strong>Degust</strong>",content:"This web tool can be used to explore overlap between gene lists.  The filters for significance can be dynamically updated; the intersection and difference between gene-lists displayed in a table and downloaded.",orphan:true,backdrop:true},{element:".fdr-fld",placement:"left",title:"<strong>FDR threshold</strong>",content:"Modify the threshold for False-Discovery-Rate.  The numbers in the table above, and in the Venn diagram are updated dynamically."},{element:".fc-fld",placement:"left",title:"<strong>Log fold-change threshold</strong>",content:"Modify the filter for significance using log fold-change.  For example, a setting of '1.0' will determine a gene as significant if it has log fold-change greater than 1.0 or less than -1.0 (that is 2x up or down)."},{element:"#csv-download",placement:"left",backdrop:true,title:"Gene list download",content:"Anything displayed in the gene list table can be downloaded as a CSV file."}];window.setup_tour=function(show_tour){var tour;tour=new Tour;tour.addSteps(tour_steps);$("a#tour").click(function(){return tour.restart()});if(show_tour){return tour.start()}}},{}],11:[function(require,module,exports){var Handlebars=require("handlebars-runtime");module.exports=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];helpers=this.merge(helpers,Handlebars.helpers);data=data||{};var buffer="",stack1,functionType="function",escapeExpression=this.escapeExpression;buffer+='    <div class="navbar navbar-inverse navbar-fixed-top">\n      <div class="container">\n        <div class="navbar-header">\n          <a class="navbar-brand" href="';if(stack1=helpers.home_link){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.home_link;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"\">Degust : </a>\n          <span class=\"navbar-brand exp-name\"></span>\n        </div>\n        <ul class=\"nav navbar-nav navbar-right\">\n          <li><a class=\"log-link\" href=\"#\">Logs</a>\n          <li><a id=\"tour\" href=\"#\">Tour</a>\n          <li><a class=\"config hide\" href=\"#\">Configure</a>\n          <li><a href=\"#about-modal\" data-toggle=\"modal\">About</a>\n        </ul>\n      </div>\n    </div>\n\n    <div class='log-list'>\n      <h4>Log messages</h4>\n    </div>\n    \n    <div class='container'>\n      <div class='right'>\n        <div class='filter'>\n          <h4>Options</h4>\n          <div title='Filter genes by False Discovery Rate' data-placement='left'>\n            <label>FDR cut-off</label>\n            <input class=\"fdr-fld\" type=\"text\" value=\"0.01\" />\n            <div id='fdrSlider'></div>\n          </div>\n          <div title='Filter genes by absolute of the log Fold Change' data-placement='left'>\n            <label>abs log FC</label>\n            <input class=\"fc-fld\" type=\"text\" value=\"0\" />\n            <div id='fcSlider'></div>\n          </div>\n          <div title='Show FC from selected condition' data-placement='left'>\n            <label for='fc-relative'>FC relative to</label>\n            <select id='fc-relative'></select>\n          </div>\n          <div title='FC for the MA-plot' data-placement='left' class='ma-fc-col-opt'>\n            <label for='ma-fc-col'>MA-Plot FC</label>\n            <select id='ma-fc-col'></select>\n          </div>\n          <div title='Show raw counts in the table' data-placement='left' class='show-counts-opt'>\n            <label for='show-counts-cb'>Show Counts</label>\n            <input type=\"checkbox\" id='show-counts-cb'>\n          </div>\n        </div>\n\n        <div class='filter kegg-filter'>\n          <h4>Kegg Pathway</h4>\n          <select id='kegg'></select>\n        </div>\n\n        <div class='right'>\n          <a class='show-r-code' href='#'>Show R code</a>\n        </div>\n      </div>\n\n      <div class='row'>\n        <div class='col-md-2 conditions'>\n          <h3>Conditions</h3>\n          <div id='files'></div>\n        </div>\n\n        <div class='col-md-6' id='expression'>\n          <div id='loading'><img src='";if(stack1=helpers.asset_base){stack1=stack1.call(depth0,{hash:{},data:data})}else{stack1=depth0.asset_base;stack1=typeof stack1===functionType?stack1.apply(depth0):stack1}buffer+=escapeExpression(stack1)+"images/ajax-loader.gif'></div>\n          <ul class=\"nav nav-tabs\">\n            <li id='select-pc'><a href=\"#\">Expression : Parallel Coordinates</a></li>\n            <li id='select-ma'><a href=\"#\">Expression : MA plot</a></li>\n          </ul>\n          <div id=\"dge-pc\" class=\"parcoords\"></div>\n          <div id=\"dge-ma\" class=\"dge-ma\"></div>\n        </div>\n      </div>\n\n      <div class='row'>\n        <div id=\"heatmap-info\"></div>\n        <div id='heatmap'></div>\n      </div>\n\n      <div class='row'>\n        <h2>Genes</h2>\n        <div>\n          <div class=\"tab-search\">\n            Search:\n            <input type=\"text\">\n          </div>\n          <a id='csv-download' href='#'>Download CSV</a>\n          <div id=\"grid-info\"></div>\n        </div>\n        <div id=\"grid\"></div>\n        <div id=\"gene-info\"></div>\n      </div>\n\n    </div>\n\n    <div id='kegg-image'></div>\n\n    <!-- About box Modal -->\n    <div id=\"about-modal\"></div>\n\n    <!-- Modal for showing R code -->\n    <div id='code-modal' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>\n      <div class='modal-dialog'>\n        <div class='modal-content'>\n          <div class='modal-header'>\n            <button type='button' class='close' data-dismiss='modal' aria-hidden='true'>x</button>\n            <h3>DGE R Code</h3>\n          </div>\n          <div class='modal-body'>\n            This is the R code the backend used to perform the DGE analysis for the current page.\n            <pre class='r-code'>\n            </pre>\n          </div>\n          <div class='modal-footer'>\n            <button class='btn btn-primary' data-dismiss='modal' aria-hidden='true'>Close</button>\n          </div>\n        </div><!-- /.modal-content -->\n      </div><!-- /.modal-dialog -->\n    </div><!-- /.modal -->\n";return buffer})},{"handlebars-runtime":12}],12:[function(require,module,exports){var Handlebars={};module.exports=Handlebars;(function(Handlebars,undefined){Handlebars.VERSION="1.0.0";Handlebars.COMPILER_REVISION=4;Handlebars.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};Handlebars.helpers={};Handlebars.partials={};var toString=Object.prototype.toString,functionType="[object Function]",objectType="[object Object]";Handlebars.registerHelper=function(name,fn,inverse){if(toString.call(name)===objectType){if(inverse||fn){throw new Handlebars.Exception("Arg not supported with multiple helpers")}Handlebars.Utils.extend(this.helpers,name)}else{if(inverse){fn.not=inverse}this.helpers[name]=fn}};Handlebars.registerPartial=function(name,str){if(toString.call(name)===objectType){Handlebars.Utils.extend(this.partials,name)}else{this.partials[name]=str}};Handlebars.registerHelper("helperMissing",function(arg){if(arguments.length===2){return undefined}else{throw new Error("Missing helper: '"+arg+"'")}});Handlebars.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse||function(){},fn=options.fn;var type=toString.call(context);if(type===functionType){context=context.call(this)}if(context===true){return fn(this)}else if(context===false||context==null){return inverse(this)}else if(type==="[object Array]"){if(context.length>0){return Handlebars.helpers.each(context,options)}else{return inverse(this)}}else{return fn(context)}});Handlebars.K=function(){};Handlebars.createFrame=Object.create||function(object){Handlebars.K.prototype=object;var obj=new Handlebars.K;Handlebars.K.prototype=null;return obj};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(level,obj){if(Handlebars.logger.level<=level){var method=Handlebars.logger.methodMap[level];if(typeof console!=="undefined"&&console[method]){console[method].call(console,obj)}}}};Handlebars.log=function(level,obj){Handlebars.logger.log(level,obj)};Handlebars.registerHelper("each",function(context,options){var fn=options.fn,inverse=options.inverse;var i=0,ret="",data;var type=toString.call(context);if(type===functionType){context=context.call(this)}if(options.data){data=Handlebars.createFrame(options.data)}if(context&&typeof context==="object"){if(context instanceof Array){for(var j=context.length;i<j;i++){if(data){data.index=i}ret=ret+fn(context[i],{data:data})}}else{for(var key in context){if(context.hasOwnProperty(key)){if(data){data.key=key}ret=ret+fn(context[key],{data:data});i++}}}}if(i===0){ret=inverse(this)}return ret});Handlebars.registerHelper("if",function(conditional,options){var type=toString.call(conditional);if(type===functionType){conditional=conditional.call(this)}if(!conditional||Handlebars.Utils.isEmpty(conditional)){return options.inverse(this)}else{return options.fn(this)}});Handlebars.registerHelper("unless",function(conditional,options){return Handlebars.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn})});Handlebars.registerHelper("with",function(context,options){var type=toString.call(context);if(type===functionType){context=context.call(this)}if(!Handlebars.Utils.isEmpty(context))return options.fn(context)});Handlebars.registerHelper("log",function(context,options){var level=options.data&&options.data.level!=null?parseInt(options.data.level,10):1;Handlebars.log(level,context)});var errorProps=["description","fileName","lineNumber","message","name","number","stack"];Handlebars.Exception=function(message){var tmp=Error.prototype.constructor.apply(this,arguments);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]]}};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(string){this.string=string};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var badChars=/[&<>"'`]/g;var possible=/[&<>"'`]/;var escapeChar=function(chr){return escape[chr]||"&amp;"};Handlebars.Utils={extend:function(obj,value){for(var key in value){if(value.hasOwnProperty(key)){obj[key]=value[key]}}},escapeExpression:function(string){if(string instanceof Handlebars.SafeString){return string.toString()}else if(string==null||string===false){return""}string=string.toString();if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)},isEmpty:function(value){if(!value&&value!==0){return true}else if(toString.call(value)==="[object Array]"&&value.length===0){return true}else{return false}}};Handlebars.VM={template:function(templateSpec){var container={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(i,fn,data){var programWrapper=this.programs[i];
if(data){programWrapper=Handlebars.VM.program(i,fn,data)}else if(!programWrapper){programWrapper=this.programs[i]=Handlebars.VM.program(i,fn)}return programWrapper},merge:function(param,common){var ret=param||common;if(param&&common){ret={};Handlebars.Utils.extend(ret,common);Handlebars.Utils.extend(ret,param)}return ret},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop,compilerInfo:null};return function(context,options){options=options||{};var result=templateSpec.call(container,Handlebars,context,options.helpers,options.partials,options.data);var compilerInfo=container.compilerInfo||[],compilerRevision=compilerInfo[0]||1,currentRevision=Handlebars.COMPILER_REVISION;if(compilerRevision!==currentRevision){if(compilerRevision<currentRevision){var runtimeVersions=Handlebars.REVISION_CHANGES[currentRevision],compilerVersions=Handlebars.REVISION_CHANGES[compilerRevision];throw"Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+")."}else{throw"Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+")."}}return result}},programWithDepth:function(i,fn,data){var args=Array.prototype.slice.call(arguments,3);var program=function(context,options){options=options||{};return fn.apply(this,[context,options.data||data].concat(args))};program.program=i;program.depth=args.length;return program},program:function(i,fn,data){var program=function(context,options){options=options||{};return fn(context,options.data||data)};program.program=i;program.depth=0;return program},noop:function(){return""},invokePartial:function(partial,name,context,helpers,partials,data){var options={helpers:helpers,partials:partials,data:data};if(partial===undefined){throw new Handlebars.Exception("The partial "+name+" could not be found")}else if(partial instanceof Function){return partial(context,options)}else if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+name+" could not be compiled when running in runtime-only mode")}else{partials[name]=Handlebars.compile(partial,{data:data!==undefined});return partials[name](context,options)}}};Handlebars.template=Handlebars.VM.template})(Handlebars)},{}]},{},[1]);